{% extends "base.html" %}

{% block form %}
  <form method="post" id="translate">
	<fieldset>
      <input placeholder="{{ placeholder }}" name="phrase" class='phrase'>
      <button class="chew-btn chew-btn-active" type="submit" onclick="analytics.track('Click Translate button', {category: 'Main Page',label: 'nth page'});"></button>
    </fieldset>
  </form>

<script>
// Validate
$('#translate').submit(function() {
  if($('.phrase').val() == ''){
	$('.phrase').addClass('invalid-input')
    return false;
  }
});

</script>
{% endblock %}


{% block translate %}
 <p><strong>Wookie Translation:</strong> {{ translation }} </p>
{% endblock %}

{% block banner %}
  <a id="BannerAd" href="https://twitter.com/Wookingtonchew" target="_blank" onClick="analytics.track('Banner Clicked', {category: 'Translated Page',label: 'Skinny V1'});"><img style="margin-top: 20px;" src="/img/chewy_banner_ad2.jpg" width="600" /></a>
  <!-- Only show banner for 40% of traffic -->
  <script>
  var rando = Math.floor(Math.random() * 10);
  if(rando < 6) {
    $('#BannerAd').hide();
  }
  </script>
{% endblock %}


{% block share %}

  <script src='http://connect.facebook.net/en_US/all.js'></script>
  <script>

    // Initializing FB SDK opens up lots of possibilities
    FB.init({appId: "45549182362", status: true, cookie: true});

    function postToFeed() {

      // Track user intent to share
      console.log('postToFeed');
      analytics.track('Share', {category: 'Translated Page',label: 'Facebook'});
      analytics.track('Click', {category: 'Social',label: 'Facebook Share Button'});

      // calling the API ...
      var obj = {
        method: 'feed',
        redirect_uri: 'http://www.wookietranslator.com',
        link: 'http://www.wookietranslator.com/uughghhhgh/{{ translationId }}',
        name: 'uughghhhgh',
        caption: 'uughgggghh',
  		  picture: 'http://www.wookietranslator.com/img/og.png',
        description: 'uughghhhgh uughghhhgh Wadu Hek'
      };

      function callback(response) {
        console.log('callback',response)
        if(!response) {
          console.log('user probly cancelled posting to fb')
          analytics.track('API Response', {category: 'Social',label: 'Facebook Share Cancelled'});
        } else {
          analytics.track('API Response', {category: 'Social',label: 'Facebook Share Success'});
          console.log('user probly posted to fb')
        }
        // document.getElementById('msg').innerHTML = "Post ID: " + response['post_id'];
      }
      FB.ui(obj, callback);
    }

  </script>

<style>
.public-btn {
  border: solid 1px black;
    background-repeat: no-repeat;
    color: white;
    text-decoration: none;
    background-color: white;
    padding: 8px 17px;
    font: 100 13px system-ui;
    background-color: #2E933C;
    border-radius: 3px;
    }
  </style>
<p>
	<span class='share-text'>Share <b><i>your</i></b> translation!</span>
</p>

<p>
  <a class="twitter-share-button"
    href="https://twitter.com/intent/tweet?text=Check%20out%20what%20I%20just%20discovered&url=http://www.wookietranslator.com/uughghhhgh/{{ translationId }}"
    data-size="large">
  Tweet</a>
  <a href="javascript:void(0);" onClick="postToFeed();"><img src="/img/fb_share.png" style="margin-left:30px;"/></a>
</p>

<p style="margin-top:30px;">
<a class="public-btn" href="javascript:void(0);" onclick="analytics.track('Make my translations public', {category: 'Translated Page Page',label: 'testing waters'});alert('Thank you. We are going to experiment with this and see how it goes. Check back soon!')">Make my translations public</a>
</p>

  <script type="text/javascript">

    // TWITTER API

    window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
      t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);

    t._e = [];
    t.ready = function(f) {
      t._e.push(f);
    };

    return t;
  }(document, "script", "twitter-wjs"));


  function clickEventToAnalytics (intentEvent) {
    if (!intentEvent) return;
    var label = intentEvent.region;
    analytics.track('Share', {category: 'Translated Page',label: 'Twitter'})
  }

  // Wait for the asynchronous resources to load
  // Then track any click event to the share button
  twttr.ready(function (twttr) {
    twttr.events.bind('click', clickEventToAnalytics);
  });

</script>



{% endblock %}
